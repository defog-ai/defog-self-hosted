# builds image for the agents backend
FROM python:3.10

WORKDIR backend

ARG OPENAI_API_KEY=""

# set env vars
ENV OPENAI_API_KEY=$OPENAI_API_KEY

# need cmake for scikit
RUN apt-get update && apt-get install -y python3-pip cmake

COPY ./backend/requirements.txt ./requirements.txt

RUN pip install -r ./requirements.txt

# expose python server port
EXPOSE 1235

# create empty report assets dirs
RUN mkdir -p /agents-assets/report-assets
RUN mkdir -p /agents-assets/report-assets/boxplots 
RUN mkdir -p /agents-assets/report-assets/datasets 
RUN mkdir -p /agents-assets/report-assets/heatmaps 
RUN mkdir -p /agents-assets/report-assets/kaplan-meier-plots 
RUN mkdir -p /agents-assets/report-assets/linechart 
RUN mkdir -p /agents-assets/report-assets/linecharts
RUN touch /agent-logs-out

ENV PYTHONUNBUFFERED=true

# start startup script
CMD sh ./startup.sh