(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{34376:function(e,t,a){e.exports=a(84142)},97362:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/extract-metadata",function(){return a(16334)}])},31143:function(e,t,a){"use strict";var s=a(28598),o=a(1887),n=a.n(o);t.Z=()=>(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},62429:function(e,t,a){"use strict";var s=a(28598),o=a(82684),n=a(91568),l=a(79869);t.Z=e=>{let{id:t,userType:a,children:i}=e,{Content:r,Sider:d}=l.Layout,[c,h]=(0,o.useState)([]),[p,u]=(0,o.useContext)(n._),logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),u({user:null,token:null,userType:null}),window.location.href="/login"};return(0,o.useEffect)(()=>{h("admin"==a?[{key:"manage-database",title:"Manage Database",icon:(0,s.jsx)("a",{href:"/extract-metadata",children:"\uD83D\uDCBE Manage DB"})},{key:"manage-users",title:"Manage Users",icon:(0,s.jsx)("a",{href:"/manage-users",children:"\uD83D\uDD10 Manage Users"})},{key:"view-notebook",title:"View your notebook",icon:(0,s.jsx)("a",{href:"/view-notebooks",children:"\uD83D\uDCD2 Your Notebooks"})},{key:"logout",title:"Logout",icon:(0,s.jsx)("a",{href:"#",onClick:logout,children:"â†ª Logout"})}]:[{key:"view-notebook",title:"View your notebook",icon:(0,s.jsx)("a",{href:"/view-notebooks",children:"Your Notebooks"})},{key:"logout",title:"Logout",icon:(0,s.jsx)("a",{href:"#",onClick:logout,children:"Logout"})}])},[a]),(0,s.jsx)(l.Layout,{style:{height:"100vh"},children:(0,s.jsxs)(r,{children:[(0,s.jsx)(d,{style:{height:"100vh",position:"fixed"},children:(0,s.jsx)(l.v2,{style:{width:200,paddingTop:"2em",paddingBottom:"2em"},mode:"inline",selectedKeys:[t],items:c})}),(0,s.jsx)("div",{style:{paddingLeft:240,paddingTop:30,backgroundColor:"#f5f5f5"},children:i})]})})}},16334:function(e,t,a){"use strict";a.r(t);var s=a(28598),o=a(82684),n=a(34376),l=a(91568),i=a(31143),r=a(62429),d=a(79869);t.default=()=>{let{Option:e}=d.Select,[t,a]=(0,o.useState)(null),[c,h]=(0,o.useState)({}),[p,u]=(0,o.useState)([]),[m,g]=(0,o.useState)(!1),[x,y]=(0,o.useState)(!1),[b,f]=(0,o.useState)([]),[w,j]=(0,o.useContext)(l._),[k,_]=(0,o.useState)([]),v=(0,n.useRouter)(),[T,S]=(0,o.useState)("admin"),getTables=async()=>{let e=w.token;if(!e)return;let t=await fetch("http://".concat("localhost:1235","/integration/get_tables_db_creds"),{method:"POST",body:JSON.stringify({token:e})}),s=await t.json();s.error||(console.log(s),a(s.db_type),h(s.db_creds),u(s.tables),_(s.selected_tables))},getMetadata=async()=>{let e=w.token;if(!e)return;let t=await fetch("http://".concat("localhost:1235","/integration/get_metadata"),{method:"POST",body:JSON.stringify({token:e})}),a=await t.json();a.error||f((null==a?void 0:a.metadata)||[])};(0,o.useEffect)(()=>{g(!0);let e=w.userType,t=w.token;if(!e){let a=localStorage.getItem("defogUser");if(t=localStorage.getItem("defogToken"),e=localStorage.getItem("defogUserType"),!a||!t||!e){v.push("/login");return}j({user:a,token:t,userType:e})}S(e),void 0===e?v.push("/login"):"admin"!==e&&v.push("/"),getTables().then(()=>{getMetadata().then(()=>{g(!1)})})},[w,w.token]);let C={postgres:["host","port","user","password","database"],mysql:["host","port","user","password","database"],redshift:["host","port","user","password","database"],snowflake:["account","warehouse","user","password"],databricks:["server_hostname","access_token","http_path","schema"]};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{}),(0,s.jsxs)(r.Z,{id:"manage-database",userType:"admin",children:[(0,s.jsx)("h1",{style:{paddingBottom:"1em"},children:"Extract Metadata"}),(0,s.jsxs)(d.X2,{type:"flex",height:"100vh",children:[(0,s.jsx)(d.JX,{md:{span:8},xs:{span:24},children:(0,s.jsxs)("div",{children:[(0,s.jsxs)(d.l0,{name:"db_creds",labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:400},disabled:x,onFinish:async e=>{e={db_creds:e,db_type:e.db_type||t,token:w.token},y(!0);try{let t=await fetch("http://".concat("localhost:1235","/integration/generate_tables"),{method:"POST",body:JSON.stringify(e)}),a=await t.json();u(a.tables)}catch(e){console.log(e)}y(!1)},children:[(0,s.jsx)(d.l0.Item,{name:"db_type",label:"Database Type",children:(0,s.jsx)(d.Select,{style:{width:"100%"},onChange:e=>{a(e)},defaultValue:t,options:["databricks","mysql","postgres","redshift","snowflake"].map(e=>({value:e,key:e,label:e}))},"db-type-"+t)}),void 0!==C[t]&&C[t].map(e=>(0,s.jsx)(d.l0.Item,{label:e,name:e,initialValue:c[e],children:(0,s.jsx)(d.II,{style:{width:"100%"}})},t+"_"+e+"_"+c[e])),(0,s.jsx)(d.l0.Item,{wrapperCol:{span:24},children:(0,s.jsx)(d.zx,{type:"primary",style:{width:"100%"},htmlType:"submit",loading:m,children:"Get Tables"})})]}),p.length>0&&(0,s.jsxs)(d.l0,{name:"db_tables",labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:400},disabled:m,onFinish:async e=>{g(!0);let t=await fetch("http://".concat("localhost:1235","/integration/generate_metadata"),{method:"POST",body:JSON.stringify({tables:e.tables,token:w.token})}),a=await t.json();g(!1),f((null==a?void 0:a.metadata)||[])},children:[(0,s.jsx)(d.l0.Item,{name:"tables",label:"Tables to index",value:k,children:(0,s.jsx)(d.Select,{mode:"multiple",style:{width:"100%",maxWidth:400},placeholder:"Select tables to index",defaultValue:k,onChange:e=>{console.log(e),_(e)},children:p.map(t=>(0,s.jsx)(e,{value:t,children:t},t))})}),(0,s.jsx)(d.l0.Item,{wrapperCol:{span:24},children:(0,s.jsx)(d.zx,{type:"primary",style:{width:"100%",maxWidth:535},htmlType:"submit",children:"Extract Metadata"})})]})]})}),(0,s.jsxs)(d.JX,{md:{span:16},xs:{span:24},style:{paddingRight:"2em",height:600,overflowY:"scroll"},children:[b.length>0&&(0,s.jsx)(d.zx,{type:"primary",style:{width:"100%",maxWidth:535},disabled:m,loading:m,onClick:async()=>{g(!0);let e=await fetch("http://".concat("localhost:1235","/integration/update_metadata"),{method:"POST",body:JSON.stringify({token:w.token,metadata:b})}),t=await e.json();console.log(t),g(!1),void 0!==t.suggested_joins&&null!==t.suggested_joins&&""!==t.suggested_joins&&(document.getElementById("allowed-joins").value=t.suggested_joins),d.yw.success("Metadata updated successfully!")},children:"Update metadata on server"}),b.length>0?(0,s.jsxs)(d.X2,{style:{marginTop:"1em",position:"sticky",top:0,paddingBottom:"1em",paddingTop:"1em",backgroundColor:"white",zIndex:100},children:[(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:(0,s.jsx)("b",{children:"Table Name"})}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:(0,s.jsx)("b",{children:"Column Name"})}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:(0,s.jsx)("b",{children:"Data Type"})}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:12},children:(0,s.jsx)("b",{children:"Description (Optional)"})})]}):null,b.length>0&&b.map((e,t)=>(0,s.jsxs)(d.X2,{style:{marginTop:"1em"},children:[(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:e.table_name}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:e.column_name}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:4},style:{overflowWrap:"break-word"},children:e.data_type}),(0,s.jsx)(d.JX,{xs:{span:24},md:{span:12},children:(0,s.jsx)(d.II.TextArea,{placeholder:"Description of what this column does",defaultValue:e.column_description,autoSize:{minRows:2},onChange:e=>{let a=[...b];a[t].column_description=e.target.value,f(a)}},t)})]},t))]})]})]})]})}}},function(e){e.O(0,[456,958,774,888,179],function(){return e(e.s=97362)}),_N_E=e.O()}]);