(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[597],{7081:(e,r,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/evaluate-model",function(){return a(6392)}])},6389:(e,r,a)=>{"use strict";a.d(r,{A:()=>d});var s=a(5105),l=a(9035),t=a.n(l);let d=()=>(0,s.jsxs)(t(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},3360:(e,r,a)=>{"use strict";a.d(r,{A:()=>n});var s=a(5105),l=a(8101),t=a(3472),d=a(6665),i=a(6159),o=a(4799);let n=e=>{let{id:r,userType:a,children:n,rootClassNames:c="",contentClassNames:u="max-h-full h-full",containerClassNames:m="flex flex-col md:min-h-screen relative container mx-auto"}=e,[g,x]=(0,l.useState)([]),h=(0,t.useRouter)(),y=e=>{h.push(e)},p=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),y("/log-in")},b=(0,i.usePathname)();return(0,l.useEffect)(()=>{x(("admin"==a?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"manage-users",title:"Manage Users",href:"/manage-users"},{key:"align-model",title:"Align Model",href:"/align-model"},{key:"evaluate-model",title:"Evaluate Model",href:"/evaluate-model"}]},{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:p}]:a?[{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:p}]:[]).map(e=>(e.current=e.href==b,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==b,e))),e)))},[a]),(0,s.jsxs)("div",{className:(0,o.QP)(m,c),children:[g.length?(0,s.jsx)(d.jq,{rootClassNames:(0,o.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:g.map(e=>({...e,classNames:(0,o.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)("div",{className:u,children:n})]})}},6392:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>x});var s=a(5105),l=a(6389),t=a(3360),d=a(8101),i=a(9783),o=a(8756),n=a(7843),c=a(5710),u=a(4379),m=a(6665),g=a(3184);function x(){let[e,r]=(0,d.useState)([]),[a,x]=(0,d.useState)(null),[h,y]=(0,d.useState)(null),[p,b]=(0,d.useState)([]),[v,f]=(0,d.useState)({questions:[],sql:"",id:crypto.randomUUID()}),[N,j]=(0,d.useState)(""),[k,w]=(0,d.useState)(""),[q,S]=(0,d.useState)(!1),C=(0,d.useContext)(m.oS),_=(0,d.useMemo)(()=>v.questions.slice(0,-1),[v.questions]),A=(0,d.useMemo)(()=>v.questions.slice(-1),[v.questions]),E=async e=>{let a=await fetch((g.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!a.ok)throw Error("Failed to get api key names. Check your network?");r((await a.json()).db_names||[])};(0,d.useEffect)(()=>{let e=localStorage.getItem("defogToken");y(e),e&&E(e);let r=localStorage.getItem("defogDbSelected");r&&x(r)},[]),(0,d.useEffect)(()=>{a&&localStorage.setItem("defogDbSelected",a)},[a]);let T=(0,d.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{S(e?e.id:"all");let r=await fetch((0,u.A)("http","readiness/regression_results"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:h,key_name:a,queries:e?[e]:p})}),s=(await r.json()).query_wise_results||{};b(e=>e.map(e=>{var r;return{...e,validationResult:null!==(r=s[e.id])&&void 0!==r?r:e.validationResult}}))}catch(e){console.error(e)}finally{S(!1)}},[p,a,h]),I=e=>{if(!(null==e?void 0:e.length))return;let r=e[0];if("application/json"!==r.type){C.error("Only JSON files accepted");return}let a=new FileReader;a.onload=e=>{var r;let a=null==e?void 0:null===(r=e.target)||void 0===r?void 0:r.result;if(a)try{let e=JSON.parse(a.toString());if(Array.isArray(e)){if(!e.every(e=>Array.isArray(e.questions)&&"string"==typeof e.sql)){C.error("Invalid JSON format. Must be array of { questions[], sql: string }");return}e.forEach(e=>{e.id=crypto.randomUUID(),e.validationResult=e.validationResult||null}),b(e),C.success("JSON uploaded successfully")}else C.error("Could not upload JSON (expected an array).")}catch(e){console.error(e),C.error("Could not parse JSON file.")}},a.readAsText(r)};return(0,s.jsxs)("div",{className:"flex justify-center",children:[(0,s.jsx)(l.A,{}),(0,s.jsxs)(t.A,{id:"view-feedback",userType:"admin",children:[e.length>1&&(0,s.jsx)("div",{className:"mb-4 w-full",children:(0,s.jsx)(m.Z,{placeholder:"Select API Key",rootClassNames:"w-full",options:e.map(e=>({value:e,label:e})),value:a||void 0,onChange:e=>x(e)})}),(0,s.jsxs)("div",{className:"flex flex-col gap-3 mb-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 md:grid-cols-12 w-full bg-gray-50 dark:bg-gray-800 rounded-md border dark:border-gray-700 gap-2 divide-x dark:divide-gray-700",children:[(0,s.jsxs)("div",{className:"col-span-4 p-4 flex flex-col items-center justify-center",children:[(0,s.jsx)("input",{type:"file",accept:".json",className:"hidden",id:"file-upload",onChange:e=>I(e.target.files)}),(0,s.jsx)(m.z8,{allowMultiple:!1,acceptedFileTypes:[".json"],onDrop:e=>{I(e.dataTransfer.files)},children:(0,s.jsx)("label",{htmlFor:"file-upload",className:"w-full cursor-pointer",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 text-center border border-dashed border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,s.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDDC2️"}),(0,s.jsx)("h1",{className:"font-bold text-sm mb-2 dark:text-gray-200",children:"Upload a JSON file"}),(0,s.jsx)("p",{className:"dark:text-gray-300",children:"Click or drag files to this area to upload"})]})})})]}),(0,s.jsxs)("div",{className:"col-span-8 border-l dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center border-b dark:border-gray-700 p-4 justify-between",children:[(0,s.jsx)("h1",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:"Or add a question manually"}),(0,s.jsx)(m.$n,{variant:"primary",onClick:()=>{if(!v.questions.length&&N&&(v.questions.push(N),j("")),!v.questions.length){C.error("Please add at least one question");return}if(!v.sql){C.error("Please add the SQL query");return}b([{...v,id:crypto.randomUUID(),validationResult:null},...p]),f({questions:[],sql:"",id:crypto.randomUUID()})},children:"Add"})]}),(0,s.jsx)("div",{className:"py-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-10 px-4 gap-3",children:[(0,s.jsxs)("div",{className:"col-span-4 flex flex-col p-4 border-r dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"previous-questions relative",children:[_.length>0&&(0,s.jsx)("div",{className:"absolute z-[2] top-0 -left-2 w-1 h-full border border-r-0 border-gray-300 dark:border-gray-600"}),_.map((e,r)=>(0,s.jsx)("div",{className:"relative group text-sm mb-1 dark:text-gray-300",children:(0,s.jsx)("div",{className:"flex flex-row items-center",children:e})},r))]}),(0,s.jsx)("div",{className:"main-question mt-2",children:A.map((e,r)=>(0,s.jsx)("div",{className:"relative group text-lg font-semibold mb-4 dark:text-gray-200",children:(0,s.jsx)("div",{className:"flex flex-row items-center",children:e})},r))}),(0,s.jsxs)("div",{className:"flex flex-col text-gray-500 dark:text-gray-400",children:[(0,s.jsx)("span",{className:"text-sm mb-2",children:v.questions.length?"Keep typing to add follow-up questions":"Type + press Enter to add a question"}),(0,s.jsx)(m.pd,{placeholder:"New question",value:N,onChange:e=>j(e.target.value),inputClassNames:"rounded-md p-1 px-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",onPressEnter:e=>{N&&(f(e=>({...e,questions:[...e.questions,N]})),j(""))}})]})]}),(0,s.jsxs)("div",{className:"col-span-6 flex flex-col gap-2 p-4",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Enter the correct SQL for the final question here"}),(0,s.jsx)(n.Ay,{className:"border border-gray-300 dark:border-gray-600 dark:bg-gray-800",extensions:[(0,c.ll)(),n.Lz.lineWrapping],value:v.sql,basicSetup:{lineNumbers:!1},editable:!0,theme:"dark",onChange:e=>{f(r=>({...r,sql:e}))}})]})]})})]})]}),(0,s.jsx)("div",{className:"h-10 w-full flex items-center",children:(0,s.jsx)("div",{className:"h-0.5 w-full bg-gray-300 dark:bg-gray-700"})}),(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-md border dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center border-b dark:border-gray-700 p-4 justify-between",children:[(0,s.jsx)("h1",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:"Added questions"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.$n,{onClick:()=>{let e=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.download="regression.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)},children:"Download JSON"}),(0,s.jsxs)(m.$n,{variant:"primary",disabled:!p.length||!!q,onClick:()=>T(null),children:["all"===q&&(0,s.jsx)(m.c5,{classNames:"text-white w-4 h-4 mr-2 inline"}),"Validate All"]})]})]}),!p.length&&(0,s.jsx)("div",{className:"p-4 text-gray-500 dark:text-gray-400",children:"Please add questions above or upload a JSON file."}),p.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"px-4 my-4",children:(0,s.jsx)(m.pd,{placeholder:"Filter questions",value:k,onChange:e=>w(e.target.value),size:"small",inputClassNames:"rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 w-40 p-1 px-2"})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"grid grid-cols-12 relative even:bg-gray-100 dark:even:bg-gray-700 text-sm font-bold border-b dark:border-gray-700",children:[(0,s.jsx)("div",{className:"col-span-2 p-4 border-r dark:border-gray-700 dark:text-gray-200",children:"Question"}),(0,s.jsx)("div",{className:"col-span-4 p-4 border-r dark:border-gray-700 dark:text-gray-200",children:"Provided SQL"}),(0,s.jsx)("div",{className:"col-span-4 p-4 border-r dark:border-gray-700 dark:text-gray-200",children:"Model SQL"}),(0,s.jsx)("div",{className:"col-span-2 p-4 dark:text-gray-200",children:"Result"})]}),p.filter(e=>e.questions.some(e=>e.toLowerCase().includes(k.toLowerCase()))).map(e=>{var r;let a=e.questions.slice(0,-1),l=e.questions.slice(-1);return(0,s.jsxs)("div",{className:"grid grid-cols-12 relative even:bg-gray-100 dark:even:bg-gray-700",children:[(0,s.jsxs)("div",{className:"col-span-2 flex flex-col px-6 py-4 border-r dark:border-gray-700",children:[a.length>0&&(0,s.jsx)("div",{className:"absolute z-[2] top-0 -left-2 w-1 h-full border border-r-0 border-gray-300 dark:border-gray-600"}),a.map((e,r)=>(0,s.jsx)("div",{className:"relative group text-sm mb-1 dark:text-gray-300",children:e},r)),l.map((e,r)=>(0,s.jsx)("div",{className:"relative group text-lg font-semibold mb-4 mt-2 dark:text-gray-200",children:e},r))]}),(0,s.jsx)("div",{className:"col-span-4 border-r dark:border-gray-700 p-4",children:(0,s.jsx)(n.Ay,{className:"border border-gray-300 dark:border-gray-600 dark:bg-gray-800",extensions:[(0,c.ll)(),n.Lz.lineWrapping],value:e.sql,basicSetup:{lineNumbers:!1},editable:!1,theme:"dark"})}),(0,s.jsx)("div",{className:"col-span-4 border-r dark:border-gray-700 p-4",children:(null===(r=e.validationResult)||void 0===r?void 0:r.model_sql)?(0,s.jsx)(n.Ay,{className:"border border-gray-300 dark:border-gray-600 dark:bg-gray-800",extensions:[(0,c.ll)(),n.Lz.lineWrapping],value:e.validationResult.model_sql,basicSetup:{lineNumbers:!1},editable:!1,theme:"dark"}):null}),(0,s.jsxs)("div",{className:"col-span-2 p-4",children:[q!==e.id&&e.validationResult&&(e.validationResult.correct?(0,s.jsxs)("div",{className:"text-green-600 font-semibold mb-2",children:[(0,s.jsx)(i.A,{className:"mr-2"}),"Correct!"]}):(0,s.jsxs)("div",{className:"text-red-600 font-semibold mb-2",children:[(0,s.jsx)(o.A,{className:"mr-2"}),"Incorrect!"]})),(0,s.jsxs)(m.$n,{variant:"secondary",onClick:()=>T(e),disabled:!!q&&q!==e.id,className:"mt-2",children:[q===e.id&&(0,s.jsx)(m.c5,{classNames:"inline w-4 h-4 mr-2 text-blue-600"}),e.validationResult?"Re-validate":"Validate"]})]})]},e.id)})]})]})]})]})]})]})}},4379:(e,r,a)=>{"use strict";a.d(r,{A:()=>l});var s=a(3184);let l=(e,r)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return""!==r?"ws"===e?"".concat((s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(r):"".concat(s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(r):"".concat(s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},e=>{var r=r=>e(e.s=r);e.O(0,[701,328,766,636,593,792],()=>r(7081)),_N_E=e.O()}]);