(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[594],{147:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-users",function(){return s(1224)}])},6389:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var a=s(5105),t=s(9035),d=s.n(t);let o=()=>(0,a.jsxs)(d(),{children:[(0,a.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,a.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},3360:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var a=s(5105),t=s(8101),d=s(3472),o=s(6665),n=s(6159),l=s(4799);let i=e=>{let{id:r,userType:s,children:i,rootClassNames:c="",contentClassNames:u="max-h-full h-full",containerClassNames:m="flex flex-col md:min-h-screen relative container mx-auto"}=e,[g,y]=(0,t.useState)([]),x=(0,d.useRouter)(),h=e=>{x.push(e)},b=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),h("/log-in")},p=(0,n.usePathname)();return(0,t.useEffect)(()=>{y(("admin"==s?[{title:"Admin",href:"#!",children:[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"manage-users",title:"Manage Users",href:"/manage-users"},{key:"align-model",title:"Align Model",href:"/align-model"}]},{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:b}]:s?[{key:"query-data",title:"Query Data",href:"/query-data"},{key:"reports",title:"Reports",href:"/reports"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:b}]:[]).map(e=>(e.current=e.href==p,e)).map(e=>(e.children&&(e.children=e.children.map(e=>(e.current=e.href==p,e))),e)))},[s]),(0,a.jsxs)("div",{className:(0,l.QP)(m,c),children:[g.length?(0,a.jsx)(o.jq,{rootClassNames:(0,l.QP)("border-b dark:border-dark-border","bg-white dark:bg-dark-bg-primary","text-primary-text dark:text-dark-text-primary"),items:g.map(e=>({...e,classNames:(0,l.QP)(e.classNames,"hover:bg-gray-100 dark:hover:bg-dark-hover",e.current&&"bg-gray-100 dark:bg-dark-hover")}))}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("div",{className:u,children:i})]})}},4580:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});let a=(0,s(9834).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},1224:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>j});var a=s(5105),t=s(8101),d=s(3472),o=s(6389),n=s(3360),l=s(4379),i=s(9834);let c=(0,i.A)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);var u=s(9692),m=s(576),g=s.n(m),y=s(6665);let x=e=>{let{loading:r,getUserDets:s}=e,[d,o]=(0,t.useState)([{username:"",password:"",userType:""}]),[n,i]=(0,t.useState)("username,password,user_type\n"),[m,x]=(0,t.useState)(""),[h,b]=(0,t.useState)(!1),p=(0,t.useContext)(y.oS),f=t.useRef(null);(0,t.useEffect)(()=>{let e=d.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");i("username,password,user_type\n".concat(e))},[d]);let k=e=>(g().parse(e,{error:e=>{p.error("There was an error parsing the CSV file.")},complete:e=>{o(e.data.map(e=>({username:e.username,password:e.password,userType:e.user_type}))),b(!0),x(""),p.success("CSV file parsed successfully. Please hit 'Add Users' to proceed.")},header:!0,skipEmptyLines:!0}),!1),w=async e=>{e.preventDefault();try{let e=localStorage.getItem("defogToken"),r="username,password,user_type"!==n.trim()?{users_csv:n,token:e}:{gsheets_url:m,token:e},a=await fetch((0,l.A)("http","admin/add_users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let t=await a.json();if("success"===t.status)p.success("Users added successfully! Refreshing the user data..."),o([{username:"",password:"",userType:""}]);else throw Error(t.message||"There was an error adding the users.");await s()}catch(e){console.error("Error:",e),p.error(e.message||"There was an error adding the users. Please try again.")}finally{b(!1),i("username,password,user_type\n")}};return(0,a.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg bg-white dark:bg-gray-800",children:[(0,a.jsxs)("h1",{className:"flex items-center justify-center text-2xl mb-8 dark:text-gray-100",children:[(0,a.jsx)(c,{size:24,className:"mr-2 dark:text-blue-400"}),"Add Users via File"]}),(0,a.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-4 dark:text-gray-200",children:"Upload CSV File"}),(0,a.jsxs)("div",{className:"mb-4",children:[!h&&(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Expected columns in the file: username,password,user_type,allowed_dbs. For users that must login via SSO, please set the password column to blank."}),(0,a.jsx)("input",{type:"file",ref:f,accept:".csv",onChange:e=>{let r=e.target.files[0];r&&k(r)},className:"hidden",disabled:h||r}),(0,a.jsxs)("button",{type:"button",onClick:()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.click()},disabled:h||r,className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(u.A,{size:20,className:"mr-2"}),h?"Uploaded":"Upload CSV"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-4 dark:text-gray-200",children:"Or a paste publicly accessible Google Sheets URL"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Google Sheets URL"}),(0,a.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),className:"mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",disabled:r})]})]}),h&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Generated CSV String"}),(0,a.jsx)("textarea",{value:n,readOnly:!0,rows:4,className:"mt-1 block w-full font-mono border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 bg-gray-100 dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsx)("button",{type:"submit",disabled:"username,password,user_type"===n.trim()&&!m||r,className:"w-1/3 mx-auto block px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Users"})]})]})},h=(0,i.A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var b=s(3184);let p=e=>{let{loading:r,getUserDets:s}=e,[d,o]=(0,t.useState)([{username:"",password:"",userType:"",userDb:[]}]),[n,i]=(0,t.useState)("username,password,user_type,allowed_dbs\n"),[c,u]=(0,t.useState)([]),m=(0,t.useContext)(y.oS),g=async()=>{let e=localStorage.getItem("defogToken"),r=await fetch((b.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")+"/get_db_names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!r.ok)throw Error("Failed to get api key names - are you sure your network is working?");u((await r.json()).db_names)};(0,t.useEffect)(()=>{g();let e=d.filter(e=>e.username&&e.userType).map(e=>"".concat(e.username,",").concat(e.password||"",",").concat(e.userType,",").concat(e.userDb.join("|"))).join("\n");i("username,password,user_type,allowed_dbs\n".concat(e))},[d]);let x=(e,r,s)=>{let a=[...d];a[e][r]=s,o(a)},p=async e=>{e.preventDefault();let r=localStorage.getItem("defogToken"),a=await fetch((0,l.A)("http","admin/add_users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users_csv:n,token:r})});"success"===(await a.json()).status?(m.success("Users added successfully! Refreshing the user data..."),o([{username:"",password:"",userType:"",userDb:[]}])):m.error("There was an error adding the users. Please try again."),await s()};return(0,a.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg bg-white dark:bg-gray-800",children:[(0,a.jsxs)("h1",{className:"flex items-center justify-center text-2xl mb-8 dark:text-gray-100",children:[(0,a.jsx)(h,{size:24,className:"mr-2 dark:text-blue-400"}),"Add Users Manually"]}),(0,a.jsxs)("form",{onSubmit:p,className:"w-full space-y-6",children:[d.map((e,s)=>(0,a.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,a.jsxs)("div",{className:"w-1/4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Username",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 dark:bg-gray-700 dark:text-gray-200",value:e.username,onChange:e=>x(s,"username",e.target.value),required:!0,disabled:r})]}),(0,a.jsxs)("div",{className:"w-1/4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password (leave blank for SSO users)"}),(0,a.jsx)("input",{type:"password",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 dark:bg-gray-700 dark:text-gray-200",value:e.password,onChange:e=>x(s,"password",e.target.value),disabled:r})]}),(0,a.jsxs)("div",{className:"w-1/4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["User Type",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 dark:bg-gray-700 dark:text-gray-200",value:e.userType,onChange:e=>x(s,"userType",e.target.value),required:!0,disabled:r,children:[(0,a.jsx)("option",{value:"",children:"Select type"}),(0,a.jsx)("option",{value:"admin",children:"Admin"}),(0,a.jsx)("option",{value:"general",children:"General"})]})]}),(0,a.jsxs)("div",{className:"w-1/4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Allowed DBs (leave blank for all DBs)"}),(0,a.jsx)("select",{multiple:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2 dark:bg-gray-700 dark:text-gray-200",value:e.userDb,onChange:e=>x(s,"userDb",Array.from(e.target.selectedOptions,e=>e.value)),disabled:r,children:c.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]},s)),(0,a.jsx)("button",{type:"button",onClick:()=>o([...d,{username:"",password:"",userType:"",userDb:[]}]),className:"w-full py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:focus:ring-gray-400",disabled:r,children:"Add Another User"}),"username,password,user_type,allowed_dbs"!==n.trim()&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Generated CSV String"}),(0,a.jsx)("textarea",{value:n,readOnly:!0,rows:2,className:"w-full font-mono border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-100 dark:bg-gray-700 dark:text-gray-200 p-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),(0,a.jsx)("button",{type:"submit",className:"w-1/3 mx-auto block mt-20 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r||"username,password,user_type,allowed_dbs"===n.trim(),children:"Add Users"})]})]})};var f=s(4580);let k=e=>{let{userDets:r,getUserDets:s,loading:d,setLoading:o}=e,n=(0,t.useContext)(y.oS),i=async e=>{o(!0);let r=localStorage.getItem("defogToken"),a=await fetch((0,l.A)("http","admin/delete_user"),{method:"POST",body:JSON.stringify({username:e,token:r}),headers:{"Content-Type":"application/json"}});"success"===(await a.json()).status?n.success("User deleted successfully! Refreshing the user data..."):n.error("There was an error deleting the user. Please try again."),await s(),o(!1)},c=[{title:"User ID",dataIndex:"username",key:"username",width:"30%"},{title:"User Type",dataIndex:"user_type",key:"user_type",width:"30%"},{title:"Allowed DBs",dataIndex:"allowed_dbs",key:"allowed_dbs",width:"30%"},{title:"Action",dataIndex:"__actions",key:"delete_user",width:"10%",render:(e,r)=>(0,a.jsx)(y.$n,{variant:"normal",icon:(0,a.jsx)(f.A,{}),onClick:()=>i(r.username),className:"hover:bg-gray-100 dark:hover:bg-gray-700"})}];return(0,a.jsx)("div",{className:"w-4/6 max-h-screen overflow-y-auto mb-4",children:(0,a.jsxs)("div",{className:"relative mt-10",children:[d&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/70 dark:bg-gray-900/70 backdrop-blur-[1px] z-10",children:[(0,a.jsx)(y.c5,{classNames:"text-blue-500 h-6 w-6"}),(0,a.jsx)("span",{className:"mt-2 text-sm font-medium text-gray-600 dark:text-gray-300",children:"Getting Latest Users Data"})]}),(0,a.jsx)(y.XI,{columns:c,rows:r.map((e,r)=>({...e,key:"row-".concat(r),__origIndex:r})),rowCellRender:e=>{let{cellValue:r,row:s,dataIndex:t,column:d}=e;return"function"==typeof d.render?(0,a.jsx)("td",{className:"px-6 py-4 text-left text-sm text-gray-700 dark:text-gray-200 border-b border-gray-200 dark:border-gray-700",children:d.render(r,s)},s.key+"-"+t):(0,a.jsx)("td",{className:"px-6 py-4 text-left text-sm text-gray-700 dark:text-gray-200 border-b border-gray-200 dark:border-gray-700 whitespace-nowrap",children:r},s.key+"-"+t)},headerCellRender:e=>{let{column:r}=e;return(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",style:{width:r.width},children:r.title},r.key)},rootClassNames:"border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg bg-white dark:bg-dark-bg-secondary overflow-hidden",pagination:{defaultPageSize:10,showSizeChanger:!1},paginationPosition:"bottom",showSearch:!1})]})})},w=(0,i.A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),j=()=>{let[e,r]=(0,t.useState)(!1),[s,i]=(0,t.useState)([]),c=(0,t.useContext)(y.oS),u=(0,d.useRouter)(),m=async()=>{r(!0);let e=localStorage.getItem("defogToken");if(!e){r(!1),c.error("It seems like there was no token found in your session. Please try to log in again.");return}let s=await fetch((0,l.A)("http","admin/get_users"),{method:"POST",body:JSON.stringify({token:e}),headers:{"Content-Type":"application/json"}}),a=await s.json();a.users?i(a.users):c.error("There was an error fetching the user data. Please try again."),r(!1)};return(0,t.useEffect)(()=>{let e=localStorage.getItem("defogUser"),r=localStorage.getItem("defogToken"),s=localStorage.getItem("defogUserType");if(!e||!r||!s){u.push("/log-in");return}r?m():u.push("/log-in")},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{}),(0,a.jsxs)(n.A,{id:"manage-users",userType:"admin",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-5",children:[(0,a.jsxs)("h1",{children:[(0,a.jsx)(w,{size:48,className:"text-blue-500 dark:text-blue-400"})," "]}),(0,a.jsx)("h1",{className:"text-3xl mt-4 dark:text-gray-100",children:"Manage Users"})]}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1",children:(0,a.jsx)(k,{userDets:s,getUserDets:m,loading:e,setLoading:r})}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full",children:(0,a.jsx)(x,{loading:e,getUserDets:m})}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full mt-4 mb-4",children:(0,a.jsx)(p,{loading:e,getUserDets:m})})]})]})}},4379:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});var a=s(3184);let t=(e,r)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return""!==r?"ws"===e?"".concat((a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(r):"".concat(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(r):"".concat(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},e=>{var r=r=>e(e.s=r);e.O(0,[328,351,636,593,792],()=>r(147)),_N_E=e.O()}]);