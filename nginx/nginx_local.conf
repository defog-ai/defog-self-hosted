events {}

http {
  # HTTP Server (Port 80)
  server {
    listen 80 default_server;
    listen [::]:80 default_server;

    # for the root location, serve via root server
    location = / {
      root /var/www/html;
      index index.html index.htm;
    }

    # serve the file logo512.png via root server
    location = /logo512.png {
      root /var/www/html;
      index logo512.png;
    }

    # serve static files for all .html, .css, .js
    location ~* \.(html|css|js|ico|svg)$ {
      include /etc/nginx/mime.types;
      root /var/www/html;
      index index.html index.htm;
    }

    # for the /doc, /extract-metadata, /manage-users, /msal_redirect locations, serve via static server
    location ~* /(doc|log-in|extract-metadata|view-notebooks|manage-users|msal_redirect|query-data|align-model|test-regression|manage-tools|oracle-frontend|view-oracle-report|view-feedback|update-bedrock-params|update-openai-params) {
      root /var/www/html;
      index index.html index.htm;
      add_header Content-Type text/html;
    }

    # for most other locations, serve via python server
    location / {
      proxy_pass http://agents-python-server:1235;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
      proxy_read_timeout 120s;
      proxy_send_timeout 120s;
      keepalive_timeout 240s;
    }
  }
}